<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <!-- ============================================================================
         METADATOS Y CONFIGURACIÓN
         ============================================================================ -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Portal del Colaborador - Mediterráneo">
    <meta name="theme-color" content="#D32F2F">
    <title>Mediterráneo | Portal Colaborador</title>

    <!-- Favicon: Logo oficial de Mediterráneo -->
    <link rel="icon" type="image/png" href="https://images.rappi.pe/restaurants_logo/medtii-1566401614403-1567615042359-1569449064970-1569884397109-1764897126662.png">

    <!-- ============================================================================
         PRELOAD Y OPTIMIZACIONES DE PERFORMANCE
         ============================================================================ -->
    <!-- Preload de fuente crítica -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" as="style">
    
    <!-- DNS Prefetch para CDNs -->
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://www.gstatic.com">

    <!-- ============================================================================
         ESTILOS EXTERNOS
         ============================================================================ -->
    <!-- Bootstrap 5.3.0: Sistema de componentes y grid responsive -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"></noscript>

    <!-- Font Awesome 6.4.0: Librería de iconos -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"></noscript>

    <!-- Google Fonts: Plus Jakarta Sans (con display=swap para mejor performance) -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- SweetAlert2: Modales y alertas personalizadas -->
    <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bootstrap-4/bootstrap-4.css" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bootstrap-4/bootstrap-4.css" rel="stylesheet"></noscript>

    <!-- Estilos personalizados del proyecto -->
    <link rel="stylesheet" href="css/estilos.css">
</head>
<body>

<!-- ============================================================================
     FONDOS GRADIENTES AMBIENTALES
     ============================================================================ -->
<div class="bg-gradient"></div>

<!-- ============================================================================
     PANTALLA DE LOGIN
     ============================================================================ -->
<div id="loginScreen" class="login-overlay">
    <div class="text-center p-5 glass-card" style="max-width: 400px; width: 90%;">
        <div class="mb-4">
            <!-- Logo y branding -->
            <i class="fas fa-utensils fa-3x mb-3" style="color: var(--brand-red);"></i>
            <h2 class="fw-bold text-adaptive">Mediterráneo</h2>
            <p class="text-muted-adaptive small text-uppercase fw-bold ls-1">Portal del Colaborador</p>
        </div>

        <!-- Botón de autenticación con Google -->
        <button id="btnLogin" class="btn btn-action rounded-pill">
            <i class="fab fa-google me-2"></i> Acceder con Google
        </button>

        <!-- Copyright -->
        <p class="mt-4 small text-muted-adaptive">© 2025 Mediterráneo</p>
    </div>
</div>

<!-- ============================================================================
     CONTENEDOR PRINCIPAL DEL DASHBOARD
     ============================================================================ -->
<div id="appContainer" class="container-fluid dashboard-container d-none" style="max-width: 1000px; padding-bottom: 80px;">

    <!-- ========================================================================
         HEADER: Título y Perfil de Usuario
         ======================================================================== -->
    <div class="dashboard-header d-flex justify-content-between align-items-center mb-4 pt-4 flex-wrap gap-3">
        <div>
            <h4 class="fw-bold m-0 text-adaptive">Mis Ingresos</h4>
            <small class="text-muted-adaptive">Resumen de Propinas</small>
        </div>

        <!-- Zona de usuario y logout -->
        <div class="d-flex align-items-center gap-2 gap-md-3">
            <div class="user-pill">
                <img id="userPhoto" src="" alt="User" loading="lazy">
                <span id="userName" class="user-name-text">Usuario</span>
            </div>
            <button onclick="logout()" class="btn btn-sm text-danger" title="Cerrar Sesión">
                <i class="fas fa-sign-out-alt fa-lg"></i>
            </button>
        </div>
    </div>

    <!-- ========================================================================
         SECCIÓN 1: GRÁFICO Y PAGO DE QUINCENA (Col-6 Right)
         ======================================================================== -->
    <div class="row g-4 mb-4">
        <div class="col-md-6 order-md-2">
            <div class="glass-card p-4 h-100">
                <!-- Filtros de período -->
                <div class="d-flex justify-content-between align-items-start align-items-sm-center mb-3 flex-wrap gap-2">
                    <div>
                        <h6 class="fw-bold m-0 text-muted-adaptive text-uppercase small ls-1" style="letter-spacing: 1px;">Balance Total</h6>
                    </div>
                    <div class="btn-group-custom">
                        <button class="btn btn-filter active" id="btnDia">Hoy</button>
                        <button class="btn btn-filter" id="btnMes">Mes</button>
                        <button class="btn btn-filter" id="btnAno">Año</button>
                    </div>
                </div>

                <!-- Navegación de fechas -->
                <div class="d-flex justify-content-between align-items-center mb-4 p-3 rounded-3" style="background: rgba(128,128,128,0.03); border: 1px solid var(--border-color); gap: 2px;">
                    <button class="btn btn-sm icon-adaptive" onclick="cambiarFecha(-1)" title="Fecha anterior">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="labelFechaActual" class="fw-bold flex-grow-1 text-center" style="color: var(--brand-red); min-width: 150px;">Hoy</span>
                    <button class="btn btn-sm icon-adaptive" onclick="cambiarFecha(1)" title="Fecha siguiente">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <!-- Gráfico doughnut -->
                <div class="chart-container mb-3">
                    <canvas id="miGrafico"></canvas>
                    <div class="chart-center-text">
                        <small class="d-block text-muted-adaptive">Acumulado</small>
                        <span class="fw-bold fs-2 text-adaptive" id="totalLabel">S/0</span>
                    </div>
                </div>

                <!-- Tarjeta de resumen de pago con comisión -->
                <div class="payment-summary-card">
                    <div class="payment-header">
                        <div class="payment-title">
                            <i class="fas fa-credit-card"></i>
                            <span>Pago Quincena (Tarjetas)</span>
                        </div>
                        <span class="badge-commission" id="lblPorcentajeNiubiz">-4.50%</span>
                    </div>

                    <div class="payment-body">
                        <div class="payment-row">
                            <span class="payment-label">Bruto Tarjetas:</span>
                            <span class="payment-value text-adaptive" id="lblBrutoTarjeta">S/0.00</span>
                        </div>
                        <div class="payment-row">
                            <span class="payment-label text-danger">Comisión:</span>
                            <span class="payment-value text-danger" id="lblComisionNiubiz">- S/0.00</span>
                        </div>
                        <div class="payment-divider"></div>
                        <div class="payment-row payment-final">
                            <span class="payment-label-final">A Depositar:</span>
                            <span class="payment-value-final text-adaptive" id="lblNetoDeposito">S/0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ====================================================================
             SECCIÓN 2: FORMULARIO DE REGISTRO (Col-6 Left)
             ==================================================================== -->
        <div class="col-md-6 order-md-1">
            <div class="glass-card p-4 h-100">
                <h5 class="fw-bold mb-4 text-adaptive">Registrar Propina</h5>

                <!-- Tarjetas de método de pago -->
                <div class="row g-2 mb-4">
                    <div class="col-6 col-sm-3">
                        <div class="method-card" data-tipo="Efectivo" title="Efectivo">
                            <i class="fas fa-coins"></i>
                            <span>Efectivo</span>
                        </div>
                    </div>
                    <div class="col-6 col-sm-3">
                        <div class="method-card" data-tipo="Tarjeta" title="Tarjeta de Crédito/Débito">
                            <i class="fas fa-credit-card"></i>
                            <span>Tarjeta</span>
                        </div>
                    </div>
                    <div class="col-6 col-sm-3">
                        <div class="method-card" data-tipo="Corredor" title="Apoyo de Corredor">
                            <i class="fas fa-running"></i>
                            <span>Corredor</span>
                        </div>
                    </div>
                    <div class="col-6 col-sm-3">
                        <div class="method-card" data-tipo="Yape/Plin" title="Pago Digital">
                            <i class="fas fa-qrcode"></i>
                            <span>Digital</span>
                        </div>
                    </div>
                </div>

                <!-- Formulario de entrada -->
                <div id="form-section">
                    <!-- Input de fecha -->
                    <div class="mb-3">
                        <div class="input-group-custom">
                            <span class="currency"><i class="far fa-calendar"></i></span>
                            <input type="date" id="inputFecha" class="form-control-custom" required>
                        </div>
                    </div>

                    <!-- Input de monto -->
                    <div class="mb-3">
                        <div class="input-group-custom">
                            <span class="currency">S/</span>
                            <input 
                                type="number" 
                                id="inputMonto" 
                                class="form-control-custom" 
                                placeholder="0" 
                                min="1" 
                                max="999"
                                oninput="if(this.value.length > 3) this.value = this.value.slice(0,3);"
                                required>
                        </div>
                    </div>

                    <!-- Búsqueda de compañero (oculto por defecto, mostrado si es Corredor) -->
                    <div class="mb-3 d-none fade-in" id="divCompanero">
                        <label class="small text-muted-adaptive ms-2 mb-1">Nombre del Compañero(a):</label>
                        <div class="position-relative">
                            <div class="input-group-custom">
                                <span class="currency"><i class="fas fa-search"></i></span>
                                <input type="text" id="inputSearchCompanero" class="form-control-custom" 
                                       placeholder="Buscar compañero..." autocomplete="off" 
                                       style="padding-left: 50px;">
                                <button id="btnClearSearch" class="btn btn-sm text-muted position-absolute end-0 top-50 translate-middle-y me-3 d-none" 
                                        style="z-index: 10; border: none; background: none; cursor: pointer;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <!-- Dropdown con resultados de búsqueda -->
                            <div id="searchResults" class="search-dropdown d-none"></div>
                        </div>
                        <!-- Campos ocultos para guardar datos del compañero seleccionado -->
                        <input type="hidden" id="selectedCompaneroUid">
                        <input type="hidden" id="finalCompaneroName">
                    </div>

                    <!-- Botón de guardado -->
                    <button id="btnGuardar" class="btn-action">GUARDAR INGRESO</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================================================
         SECCIÓN 3: RANKING GLOBAL Y HISTORIAL RECIENTE
         ======================================================================== -->
    <div class="row g-4">
        <!-- Ranking Global de Apoyos (Corredores) -->
        <div class="col-md-6">
            <div class="glass-card p-4 h-100">
                <h6 class="text-muted-adaptive fw-bold small mb-3">Ranking Global de Apoyo</h6>
                <ul class="list-unstyled m-0" id="listaRanking"></ul>
            </div>
        </div>

        <!-- Historial Reciente -->
        <div class="col-md-6">
            <div class="glass-card p-4 h-100">
                <h6 class="text-muted-adaptive fw-bold small mb-3">Historial Reciente</h6>
                <div class="table-responsive">
                    <table class="table table-borderless m-0 bg-transparent text-adaptive">
                        <tbody id="tablaHistorial"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ============================================================================
     BOTÓN DE ALTERNANCIA TEMA (Oscuro/Claro)
     ============================================================================ -->
<div class="theme-pill" onclick="toggleTheme()" title="Cambiar tema">
    <i id="themeIcon" class="fas fa-moon"></i>
    <span id="themeText" class="theme-text">Modo Oscuro</span>
</div>

<!-- ============================================================================
     SCRIPTS EXTERNOS
     ============================================================================ -->
<!-- Chart.js: Librería para gráficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- SweetAlert2: Modales personalizadas -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Módulo de autenticación (entrada principal) -->
<script type="module" src="js/auth/usuario.js"></script>

<!-- ============================================================================
     SCRIPT GLOBAL: TOGGLE DE TEMA
     ============================================================================ -->
<script>
    /**
     * Alterna entre tema oscuro y claro
     * Guarda preferencia en localStorage para persistencia
     * @global
     */
    function toggleTheme() {
        const html = document.documentElement;
        const icon = document.getElementById('themeIcon');
        const text = document.getElementById('themeText');
        
        // Obtener tema actual
        const currentTheme = html.getAttribute('data-theme');
        const nextTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        // Aplicar nuevo tema
        html.setAttribute('data-theme', nextTheme);
        icon.className = nextTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        text.innerText = nextTheme === 'dark' ? 'Modo Claro' : 'Modo Oscuro';
        
        // Guardar preferencia
        localStorage.setItem('theme', nextTheme);
    }

    // Aplicar tema guardado al cargar
    if (localStorage.getItem('theme') === 'dark') {
        toggleTheme();
    }
</script>

</body>
</html>